<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø³ÙØ§Ø±Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø¨Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª</title>
    
    <style>
        :root { --primary: #d3ad7f; --bg: #13131a; --card: #1e1e24; --text: #ffffff; --green: #27ae60; --blue: #2980b9; --input-bg: #2a2a35; }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Tahoma', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background:var(--bg); color:var(--text); padding-bottom:140px; user-select: none; }
        
        /* Ù‡Ø¯Ø± */
        header { background: var(--card); padding: 20px; text-align: center; border-bottom: 2px solid var(--primary); position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        header h1 { font-size: 1.5rem; color: var(--primary); margin-bottom: 5px; }
        header p { font-size: 0.9rem; color: #ccc; }

        /* Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ */
        .cat-scroll { display: flex; gap: 10px; padding: 15px; overflow-x: auto; background: #0b0b0f; }
        .cat-btn { background: var(--card); color: #fff; padding: 8px 16px; border-radius: 20px; border: 1px solid #333; white-space: nowrap; cursor: pointer; transition: 0.3s; }
        .cat-btn.active { background: var(--primary); border-color: var(--primary); color: #000; font-weight: bold; }

        /* Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª */
        .menu-list { padding: 15px; max-width: 600px; margin: 0 auto; min-height: 300px; }
        .item { background: var(--card); border-radius: 12px; padding: 10px; margin-bottom: 12px; display: flex; gap: 12px; border: 1px solid #2a2a35; align-items: center; animation: fadeIn 0.5s; }
        .item img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; border: 1px solid var(--primary); background: #000; }
        .info { flex: 1; }
        .info h3 { font-size: 1rem; margin-bottom: 4px; }
        .info small { color: #888; font-size: 0.75rem; display: block; margin-bottom: 6px; }
        .price { color: var(--primary); font-weight: bold; font-size: 1.1rem; }
        
        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        .add-btn { background: #333; color: #fff; padding: 6px 15px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; }
        .qty-box { display: none; align-items: center; background: #000; border-radius: 6px; border: 1px solid var(--primary); }
        .qty-box.show { display: flex; }
        .q-btn { width: 35px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; }
        .q-num { width: 25px; text-align: center; font-weight: bold; font-size: 1rem; }

        /* Ø¨Ø®Ø´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ */
        .order-details { background: var(--card); padding: 15px; border-top: 2px solid var(--primary); position: fixed; bottom: 80px; left: 0; right: 0; z-index: 900; display: none; max-width: 600px; margin: 0 auto; border-radius: 15px 15px 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); }
        .order-details.active { display: block; }
        
        .type-selector { display: flex; gap: 10px; margin-bottom: 15px; }
        .type-btn { flex: 1; padding: 10px; background: #000; border: 1px solid #333; color: #888; text-align: center; border-radius: 8px; cursor: pointer; }
        .type-btn.selected { background: var(--primary); color: #000; font-weight: bold; border-color: var(--primary); }

        .input-group { margin-bottom: 8px; }
        .input-group input, .input-group textarea { width: 100%; padding: 10px; background: var(--input-bg); border: 1px solid #333; color: #fff; border-radius: 8px; outline: none; }
        .input-group textarea { resize: none; height: 60px; }
        .hidden { display: none; }

        /* ÙØ§Ú©ØªÙˆØ± Ú©ÙˆÚ†Ú© */
        .invoice-row { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; padding: 0 5px; color: #ccc; }
        .invoice-row.highlight { color: var(--primary); font-weight: bold; border-top: 1px solid #333; padding-top: 5px; margin-top: 5px; font-size: 1.1rem; }

        /* Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ† */
        .cart-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #000; padding: 15px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; border-top: 1px solid #333; }
        .final-btn { background: var(--green); color: #fff; padding: 12px; border-radius: 12px; font-weight: bold; box-shadow: 0 0 10px rgba(39, 174, 96, 0.4); cursor: pointer; font-size: 1rem; text-align: center; width: 100%; }
        .pay-btn { background: var(--blue); box-shadow: 0 0 10px rgba(41, 128, 185, 0.4); }

        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    </style>
</head>
<body>

    <header>
        <h1 id="shopName">ÙØ±ÙˆØ´Ú¯Ø§Ù‡</h1>
        <p>Ø³ÙØ§Ø±Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ†</p>
    </header>

    <div class="cat-scroll" id="cats"></div>

    <div class="menu-list" id="list">
        <p style="text-align:center; color:#666; margin-top:50px;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
    </div>

    <div class="order-details" id="orderDetails">
        <div class="type-selector">
            <div class="type-btn selected" onclick="setOrderType('table')" id="btn-table">ğŸ½ï¸ Ø¯Ø§Ø®Ù„ Ø³Ø§Ù„Ù†</div>
            <div class="type-btn" onclick="setOrderType('delivery')" id="btn-delivery">ğŸ›µ Ø¨ÛŒØ±ÙˆÙ†â€ŒØ¨Ø±</div>
        </div>

        <div style="background: #111; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
            <div class="invoice-row">
                <span>Ø¬Ù…Ø¹ Ø§Ù‚Ù„Ø§Ù…:</span>
                <span id="itemsTotal">0</span>
            </div>
            <div class="invoice-row hidden" id="deliveryRow">
                <span>Ù‡Ø²ÛŒÙ†Ù‡ Ù¾ÛŒÚ©:</span>
                <span id="deliveryPriceDisplay">0</span>
            </div>
            <div class="invoice-row highlight">
                <span>Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:</span>
                <span id="finalPayable">0</span>
            </div>
        </div>

        <div id="form-table" class="input-group">
            <input type="number" id="tableNum" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÛŒØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§: 5)">
        </div>

        <div id="form-delivery" class="hidden">
            <div class="input-group">
                <input type="tel" id="userPhone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ (Ø§Ù„Ø²Ø§Ù…ÛŒ)">
            </div>
            <div class="input-group">
                <textarea id="address" placeholder="Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒÚ©..."></textarea>
            </div>
        </div>
    </div>

    <div class="cart-bar" id="cartBar" style="display:none">
        <div class="final-btn" id="actionBtn" onclick="processOrder()">ØªÚ©Ù…ÛŒÙ„ Ø³ÙØ§Ø±Ø´</div>
    </div>

    <script src="data.js"></script>

<script>
    // --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ù‡Ù… ---
    const SETTINGS = {
        deliveryCost: 30000, // Ù‡Ø²ÛŒÙ†Ù‡ Ù¾ÛŒÚ© Ø¨Ù‡ ØªÙˆÙ…Ø§Ù† (Ø§ÛŒÙ†Ø¬Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯)
        // Ù„ÛŒÙ†Ú© Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø®ØµÛŒ (Ù…Ø«Ù„ Ø¢ÛŒØ¯ÛŒ Ù¾ÛŒ ÛŒØ§ Ø²Ø±ÛŒÙ† Ù„ÛŒÙ†Ú©)
        // Ø³Ø§Ø®ØªØ§Ø± Ù„ÛŒÙ†Ú© Ø¢ÛŒØ¯ÛŒ Ù¾ÛŒ: https://idpay.ir/YOUR_ID?amount=
        paymentBaseUrl: "https://idpay.ir/YOUR_SHOP_ID?amount=", 
        shopName: (typeof CONFIG !== 'undefined') ? CONFIG.name : "ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù…Ø§"
    };

    let cart = {};
    let orderType = 'table'; 

    function init() {
        try {
            if (typeof products === 'undefined') throw new Error("data.js not found");
            document.getElementById('shopName').innerText = SETTINGS.shopName;
            
            let catHtml = '';
            categories.forEach((c, index) => {
                let activeClass = index === 0 ? 'active' : '';
                catHtml += `<div class="cat-btn ${activeClass}" onclick="filter('${c.id}', this)">${c.t}</div>`;
            });
            document.getElementById('cats').innerHTML = catHtml;
            render('all');
        } catch (error) {
            console.error(error);
            document.getElementById('list').innerHTML = `<p style="text-align:center; color:red; padding:20px;">Ø®Ø·Ø§: ÙØ§ÛŒÙ„ Ù…Ø­ØµÙˆÙ„Ø§Øª ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>`;
        }
    }

    function render(cat) {
        const container = document.getElementById('list');
        container.innerHTML = ''; 
        const items = cat === 'all' ? products : products.filter(x => x.c === cat);
        
        let html = '';
        items.forEach(x => {
            const count = cart[x.id] || 0;
            let btnHtml = count === 0 
                ? `<div class="add-btn" onclick="upd(${x.id}, 1)">Ø§ÙØ²ÙˆØ¯Ù†</div>` 
                : `<div class="qty-box show">
                        <div class="q-btn" onclick="upd(${x.id}, 1)">+</div>
                        <div class="q-num">${count}</div>
                        <div class="q-btn" onclick="upd(${x.id}, -1)">-</div>
                   </div>`;
            html += `
            <div class="item">
                <img src="${x.i}" alt="${x.t}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1170/1170576.png'">
                <div class="info">
                    <h3>${x.t}</h3>
                    <div class="price-row" style="display:flex; justify-content:space-between; margin-top:5px; align-items:center;">
                        <span class="price">${x.p.toLocaleString()}</span>
                        ${btnHtml}
                    </div>
                </div>
            </div>`;
        });
        container.innerHTML = html;
    }

    window.filter = function(cat, el) {
        document.querySelectorAll('.cat-btn').forEach(x => x.classList.remove('active'));
        el.classList.add('active');
        render(cat);
    }

    window.upd = function(id, n) {
        if(!cart[id]) cart[id] = 0;
        cart[id] += n;
        if(cart[id] <= 0) delete cart[id];
        calcTotal();
        
        // Ø±Ù†Ø¯Ø± Ù…Ø¬Ø¯Ø¯ ÙÙ‚Ø· Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø±Ø´ (Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡: Ø±Ù†Ø¯Ø± Ú©Ù„ Ù„ÛŒØ³Øª)
        const activeBtn = document.querySelector('.cat-btn.active');
        const currentCat = activeBtn ? activeBtn.getAttribute('onclick').match(/'([^']+)'/)[1] : 'all';
        render(currentCat);
    }

    function calcTotal() {
        let itemsTotal = 0;
        let count = 0;
        for(let id in cart) {
            const p = products.find(x => x.id == id);
            if(p) {
                itemsTotal += p.p * cart[id];
                count += cart[id];
            }
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡Ø²ÛŒÙ†Ù‡ Ù†Ù‡Ø§ÛŒÛŒ
        let finalPrice = itemsTotal;
        if (orderType === 'delivery') {
            finalPrice += SETTINGS.deliveryCost;
        }

        // Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¯Ø§Ø¯
        document.getElementById('itemsTotal').innerText = itemsTotal.toLocaleString();
        document.getElementById('deliveryPriceDisplay').innerText = SETTINGS.deliveryCost.toLocaleString();
        document.getElementById('finalPayable').innerText = finalPrice.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';

        const cartBar = document.getElementById('cartBar');
        const orderDetails = document.getElementById('orderDetails');
        
        if(count > 0) {
            cartBar.style.display = 'flex';
            orderDetails.classList.add('active');
        } else {
            cartBar.style.display = 'none';
            orderDetails.classList.remove('active');
        }

        updateActionButton(finalPrice);
    }

    window.setOrderType = function(type) {
        orderType = type;
        document.getElementById('btn-table').classList.remove('selected');
        document.getElementById('btn-delivery').classList.remove('selected');
        document.getElementById('btn-' + type).classList.add('selected');

        const deliveryRow = document.getElementById('deliveryRow');
        const formTable = document.getElementById('form-table');
        const formDelivery = document.getElementById('form-delivery');

        if(type === 'table') {
            formTable.classList.remove('hidden');
            formDelivery.classList.add('hidden');
            deliveryRow.classList.add('hidden');
        } else {
            formTable.classList.add('hidden');
            formDelivery.classList.remove('hidden');
            deliveryRow.classList.remove('hidden');
        }
        calcTotal();
    }

    function updateActionButton(price) {
        const btn = document.getElementById('actionBtn');
        if (orderType === 'delivery') {
            btn.innerHTML = `ğŸ’³ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ù†Ù„Ø§ÛŒÙ† (${price.toLocaleString()})`;
            btn.classList.add('pay-btn'); // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ø¨Ù‡ Ø¢Ø¨ÛŒ
            btn.style.background = "var(--blue)";
        } else {
            btn.innerHTML = `âœ… Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø³Ø§Ù„Ù†`;
            btn.classList.remove('pay-btn');
            btn.style.background = "var(--green)";
        }
    }

    window.processOrder = function() {
        // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
        let itemsTotal = 0;
        let orderDesc = "";
        for(let id in cart) {
            const p = products.find(x => x.id == id);
            if(p) {
                itemsTotal += p.p * cart[id];
                orderDesc += `${p.t}(${cart[id]}) - `;
            }
        }
        
        let finalPrice = itemsTotal;
        
        if (orderType === 'table') {
            // Ù…Ù†Ø·Ù‚ Ø³Ø§Ù„Ù† (ÙˆØ§ØªØ³â€ŒØ§Ù¾)
            const tableNum = document.getElementById('tableNum').value;
            if(!tableNum) { alert("Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ù…ÛŒØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"); return; }
            
            let text = `*Ø³ÙØ§Ø±Ø´ Ø³Ø§Ù„Ù†* \nÙ…ÛŒØ²: ${tableNum}\n${orderDesc}\nÙ…Ø¨Ù„Øº: ${itemsTotal.toLocaleString()}`;
            window.open(`https://wa.me/${CONFIG.phone}?text=${encodeURIComponent(text)}`, '_blank');
        
        } else {
            // Ù…Ù†Ø·Ù‚ Ø¨ÛŒØ±ÙˆÙ†â€ŒØ¨Ø± (Ù¾Ø±Ø¯Ø§Ø®Øª)
            const phone = document.getElementById('userPhone').value;
            const address = document.getElementById('address').value;
            
            if(!phone || !address) { alert("Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ùˆ Ø¢Ø¯Ø±Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"); return; }
            
            finalPrice += SETTINGS.deliveryCost;

            // Ø³Ø§Ø®Øª Ù„ÛŒÙ†Ú© Ù¾Ø±Ø¯Ø§Ø®Øª
            // Ø§Ú©Ø«Ø± Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒ Ù…Ø¨Ù„Øº Ø±Ø§ Ø¨Ù‡ Ø±ÛŒØ§Ù„ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯ØŒ Ø§Ú¯Ø± ØªÙˆÙ…Ø§Ù† Ø§Ø³Øª Ø¯Ø± 10 Ø¶Ø±Ø¨ Ú©Ù†ÛŒØ¯
            // ÙØ±Ø¶ Ø¨Ø± Ø§ÛŒÙ† Ø§Ø³Øª Ú©Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ Ø´Ù…Ø§ ØªÙˆÙ…Ø§Ù† Ù‚Ø¨ÙˆÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ ÛŒØ§ Ø®ÙˆØ¯ØªØ§Ù† ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯
            // Ø¨Ø±Ø§ÛŒ Ø¢ÛŒØ¯ÛŒ Ù¾ÛŒ Ù…Ø¨Ù„Øº Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ "Ø±ÛŒØ§Ù„" Ø¨Ø§Ø´Ø¯ Ù¾Ø³ * 10
            const amountInRials = finalPrice * 10; 
            
            // ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ (Ú©Ù‡ Ù…ØªÙˆØ¬Ù‡ Ø´ÙˆÛŒØ¯ Ú†Ù‡ Ú©Ø³ÛŒ Ù¾ÙˆÙ„ ÙˆØ§Ø±ÛŒØ² Ú©Ø±Ø¯Ù‡)
            const desc = `Ø³ÙØ§Ø±Ø´: ${phone} | ${orderDesc}`;
            
            // Ø§Ú¯Ø± Ø§Ø² Ø¢ÛŒØ¯ÛŒ Ù¾ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯:
            const payUrl = `${SETTINGS.paymentBaseUrl}${amountInRials}&desc=${encodeURIComponent(desc)}`;
            
            // Ù†Ú©ØªÙ‡: Ø¨Ù‡ØªØ± Ø§Ø³Øª Ù‚Ø¨Ù„ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®Øª ÛŒÚ© Ù¾ÛŒØ§Ù… Ù‡Ù… Ø¨Ù‡ ÙˆØ§ØªØ³â€ŒØ§Ù¾ Ø¨ÙØ±Ø³ØªÛŒØ¯ Ú©Ù‡ Ø³ÙØ§Ø±Ø´ Ø«Ø¨Øª Ø´Ø¯
            if(confirm("Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ÛŒØ¯ Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ù‡Ø¯Ø§ÛŒØª Ø´ÙˆÛŒØ¯ØŸ")) {
                 window.location.href = payUrl;
            }
        }
    }

    window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
