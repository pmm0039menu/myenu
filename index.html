<!DOCTYPE html>
<html id="mainHtml" lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Menu</title>
    <style>
        :root { 
            --primary: #d3ad7f; --bg: #13131a; --card: #1e1e24; --text: #ffffff; --green: #27ae60; --blue: #2980b9; --input-bg: #2a2a35; 
            --header-img: url('https://images.unsplash.com/photo-1513104890138-7c749659a591?auto=format&fit=crop&w=1000&q=80');
            --bg-img: url('https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&w=1000&q=80');
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Tahoma', sans-serif; }
        body { background: linear-gradient(rgba(19, 19, 26, 0.85), rgba(19, 19, 26, 0.85)), var(--bg-img); background-size: cover; background-attachment: fixed; background-position: center; color:var(--text); padding-bottom:120px; user-select: none; }
        header { background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), var(--header-img); background-size: cover; background-position: center; padding: 50px 20px; text-align: center; border-bottom: 3px solid var(--primary); position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.6); }
        .lang-switch { position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; z-index: 101; }
        .lang-btn { background: rgba(0,0,0,0.7); border: 1px solid var(--primary); color: #fff; padding: 5px 10px; border-radius: 5px; font-size: 0.75rem; cursor: pointer; font-weight: bold; }
        .lang-btn.active { background: var(--primary); color: #000; }
        header h1 { font-size: 1.8rem; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); margin-bottom: 5px; }
        .status-badge { font-size: 0.85rem; padding: 5px 12px; border-radius: 12px; display: inline-block; margin-top: 5px; font-weight: bold; }
        .open { background: #27ae60; color: #fff; } .closed { background: #c0392b; color: #fff; }
        .cat-scroll { display: flex; gap: 10px; padding: 15px; overflow-x: auto; background: rgba(11, 11, 15, 0.8); backdrop-filter: blur(5px); }
        .cat-btn { background: var(--card); color: #fff; padding: 8px 16px; border-radius: 20px; border: 1px solid #333; white-space: nowrap; cursor: pointer; }
        .cat-btn.active { background: var(--primary); border-color: var(--primary); color: #000; font-weight: bold; }
        .menu-list { padding: 15px; max-width: 600px; margin: 0 auto; min-height: 300px; }
        .item { background: rgba(30, 30, 36, 0.9); border-radius: 12px; padding: 10px; margin-bottom: 12px; display: flex; gap: 12px; border: 1px solid #2a2a35; align-items: center; animation: fadeIn 0.5s; position: relative; }
        .item img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; border: 1px solid var(--primary); background: #000; }
        .price { color: var(--primary); font-weight: bold; font-size: 1.1rem; }
        .add-btn { background: #333; color: #fff; padding: 6px 15px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; }
        .qty-box { display: flex; align-items: center; background: #000; border-radius: 6px; border: 1px solid var(--primary); }
        .q-btn { width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; color: var(--primary); }
        .order-details { background: var(--card); padding: 15px; border-top: 2px solid var(--primary); position: fixed; bottom: 80px; left: 0; right: 0; z-index: 900; display: none; border-radius: 15px 15px 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); overflow-y: auto; max-height: 70vh; }
        .order-details.active { display: block; }
        .close-details { position: absolute; top: 15px; left: 15px; width: 30px; height: 30px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; cursor: pointer; border: 1px solid var(--primary); z-index: 10; }
        .type-selector { display: flex; gap: 10px; margin: 15px 0; }
        .type-btn { flex: 1; padding: 10px; background: #000; border: 1px solid #333; color: #888; text-align: center; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .type-btn.selected { background: var(--primary); color: #000; }
        .invoice-box { background: #111; padding: 10px; border-radius: 8px; margin-bottom: 15px; }
        .invoice-row { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; color: #ccc; }
        .invoice-row.highlight { color: var(--primary); font-weight: bold; border-top: 1px solid #333; padding-top: 5px; font-size: 1.1rem; }
        .summary-item { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; margin-bottom: 12px; }
        .cart-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #000; padding: 15px; z-index: 1000; display: none; border-top: 1px solid #333; }
        .final-btn { background: var(--green); color: #fff; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1rem; text-align: center; width: 100%; }
        .dev-footer { text-align: center; margin-top: 40px; padding: 30px 20px 100px 20px; border-top: 1px solid rgba(211, 173, 127, 0.2); background: rgba(14, 14, 18, 0.95); position: relative; z-index: 10; }
        .dev-icons { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        .dev-icons a { display: inline-flex; align-items: center; justify-content: center; width: 42px; height: 42px; background: #1a1a1a; border-radius: 50%; color: var(--primary); border: 1px solid var(--primary); text-decoration: none; }
        .hidden { display: none !important; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    </style>
</head>
<body id="mainBody">

    <div class="lang-switch">
        <div class="lang-btn active" id="btn-fa" onclick="changeAppLang('fa')">FA</div>
        <div class="lang-btn" id="btn-en" onclick="changeAppLang('en')">EN</div>
        <div class="lang-btn" id="btn-ar" onclick="changeAppLang('ar')">AR</div>
    </div>

    <header>
        <h1 id="shopName">...</h1>
        <div id="shopStatus" class="status-badge">...</div>
    </header>

    <div class="cat-scroll" id="cats"></div>
    <div class="menu-list" id="list"><p style="text-align:center; color:#fff; padding-top:50px;" id="loadingText">...</p></div>

    <div class="dev-footer">
        <p class="dev-title" id="devTitle" style="color: #fff; font-weight: bold;">...</p>
        <div class="dev-icons">
            <a href="tel:09123456789"><svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg></a>
            <a href="https://t.me/YOUR_ID"><svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.75-.33 1.42.2 1.17 1.38l-2.75 12.96c-.2.9-1.52.84-2.1.28l-5.31-4.22-2.58 2.48c-.28.28-.52.51-1.06.51l.39-3.98z"/></svg></a>
            <a href="https://wa.me/989123456789"><svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01C17.18 3.03 14.69 2 12.04 2zM12.05 19.81c-1.48 0-2.93-.4-4.21-1.15l-.3-.18-3.11.82.83-3.04-.19-.31c-.82-1.31-1.26-2.83-1.26-4.38 0-4.54 3.7-8.24 8.24-8.24 2.2 0 4.27.86 5.82 2.42 1.56 1.56 2.41 3.63 2.41 5.83 0 4.54-3.69 8.23-8.23 8.23z"/></svg></a>
        </div>
    </div>

    <div class="order-details" id="orderDetails">
        <div class="close-details" onclick="closeOrderWindow()">âœ•</div>
        <h3 id="reviewTitle" style="text-align:center; margin-bottom:15px; color:var(--primary);">...</h3>
        <div id="summaryList"></div>
        <div class="type-selector">
            <div class="type-btn selected" onclick="setMode('table')" id="btn-table">...</div>
            <div class="type-btn" onclick="setMode('delivery')" id="btn-delivery">...</div>
        </div>
        <div class="invoice-box">
            <div class="invoice-row"><span id="txt-sub">...</span><span id="itemsTotal">0</span></div>
            <div class="invoice-row" id="deliveryRow" style="display: none;"><span id="txt-courier">...</span><span id="deliveryPriceDisplay">0</span></div>
            <div class="invoice-row highlight"><span id="txt-final">...</span><span id="finalPayable">0</span></div>
        </div>
        <div class="input-group"><textarea id="userNote"></textarea></div>
        <div id="form-table" class="input-group"><input type="number" id="tableNum"></div>
        <div id="form-delivery" class="hidden">
            <div class="input-group"><input type="tel" id="userPhone"></div>
            <div class="input-group"><textarea id="address"></textarea></div>
        </div>
    </div>

    <div class="cart-bar" id="cartBar"><div class="final-btn" id="actionBtn" onclick="processOrder()">...</div></div>

    <script>
        const translations = {
            fa: {
                open: "âœ… Ø¨Ø§Ø² Ø§Ø³Øª", closed: "â›” Ø¨Ø³ØªÙ‡ Ø§Ø³Øª", loading: "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù†Ùˆ...", all: "Ù‡Ù…Ù‡", add: "Ø§ÙØ²ÙˆØ¯Ù†", out: "Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯",
                review: "ðŸ“‹ Ø¨Ø§Ø²Ø¨ÛŒÙ†ÛŒ Ø³ÙØ§Ø±Ø´", table: "ðŸ½ï¸ Ø³Ø§Ù„Ù†", delivery: "ðŸ›µ Ø¨ÛŒØ±ÙˆÙ†â€ŒØ¨Ø±", total: "Ø¬Ù…Ø¹ Ø§Ù‚Ù„Ø§Ù…:", courier: "Ù‡Ø²ÛŒÙ†Ù‡ Ù¾ÛŒÚ©:",
                payable: "Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:", unit: "ØªÙˆÙ…Ø§Ù†", empty: "Ø³Ø¨Ø¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª", viewBtn: "Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø³ÙØ§Ø±Ø´", payBtn: "Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ù†Ù„Ø§ÛŒÙ†", submitBtn: "Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ",
                confirm: "Ù…Ø¨Ù„Øº: {amount} ØªÙˆÙ…Ø§Ù†\nÙ¾Ø³ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø³Ú©Ø±ÛŒÙ†â€ŒØ´Ø§Øª Ø¨Ú¯ÛŒØ±ÛŒØ¯. ØªØ§ÛŒÛŒØ¯ØŸ", dev: "Ú¯Ø±ÙˆÙ‡ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±ÛŒ Ù…ÙŽØ¬Ø¯"
            },
            en: {
                open: "âœ… Open", closed: "â›” Closed", loading: "Loading...", all: "All", add: "Add", out: "Out of Stock",
                review: "ðŸ“‹ Review Order", table: "ðŸ½ï¸ Dine-in", delivery: "ðŸ›µ Delivery", total: "Subtotal:", courier: "Delivery:",
                payable: "Total:", unit: "Toman", empty: "Cart is Empty", viewBtn: "View Order", payBtn: "Pay Now", submitBtn: "Submit Order",
                confirm: "Total: {amount} Toman\nTake a screenshot of receipt. Proceed?", dev: "Majd Software Group"
            },
            ar: {
                open: "âœ… Ù…ÙØªÙˆØ­", closed: "â›” Ù…ØºÙ„Ù‚", loading: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...", all: "Ø§Ù„ÙƒÙ„", add: "Ø¥Ø¶Ø§ÙØ©", out: "ØºÛŒØ± Ù…ØªÙˆÙØ±",
                review: "ðŸ“‹ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨", table: "ðŸ½ï¸ ØµØ§Ù„Ø©", delivery: "ðŸ›µ ØªÙˆØµÙŠÙ„", total: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:", courier: "Ø§Ù„ØªÙˆØµÙŠÙ„:",
                payable: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:", unit: "ØªÙˆÙ…Ø§Ù†", empty: "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©", viewBtn: "Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨", payBtn: "ØªØ£ÙƒÙŠØ¯ ÙˆØ¯ÙØ¹", submitBtn: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨",
                confirm: "Ø§Ù„Ù…Ø¨Ù„Øº: {amount} ØªÙˆÙ…Ø§Ù†\nÙŠØ±Ø¬Ù‰ ØªØµÙˆÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹. Ù…ÙˆØ§ÙÙ‚ØŸ", dev: "Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø¬Ø¯ Ù„Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª"
            }
        };

        let curLang = 'fa', currentCat = 'all', products = [], cart = {}, config = { isOpen:true, deliveryPrice:0, names:{} };
        const sheetId = "1XoE-tWd9sor7HgqQe67z3JQCZyvt6G-IcSz9u1miRiw";

        function changeAppLang(lang) {
            curLang = lang;
            const t = translations[lang];
            document.getElementById('mainHtml').dir = (lang === 'en') ? 'ltr' : 'rtl';
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.id === 'btn-'+lang));

            document.getElementById('loadingText').innerText = t.loading;
            document.getElementById('reviewTitle').innerText = t.review;
            document.getElementById('btn-table').innerText = t.table;
            document.getElementById('btn-delivery').innerText = t.delivery;
            document.getElementById('txt-sub').innerText = t.total;
            document.getElementById('txt-courier').innerText = t.courier;
            document.getElementById('txt-final').innerText = t.payable;
            document.getElementById('devTitle').innerText = t.dev;
            
            // Ø¢Ù¾Ø¯ÛŒØª Ù†Ø§Ù… ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ø¨Ø§Ù†
            document.getElementById('shopName').innerText = config.names[lang] || config.names['fa'] || 'Menu';

            const s = document.getElementById('shopStatus');
            s.innerText = config.isOpen ? t.open : t.closed;
            s.className = "status-badge " + (config.isOpen ? "open" : "closed");

            if (products.length > 0) renderMenu(currentCat);
            calcTotal();
        }

        async function startApp() {
            try {
                const [menuRes, setRes] = await Promise.all([
                    fetch(`https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=Menu&cb=${Date.now()}`),
                    fetch(`https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=Settings&cb=${Date.now()}`)
                ]);
                parseSettings(await setRes.text());
                parseMenu(await menuRes.text());
                changeAppLang('fa');
            } catch (e) { document.getElementById('list').innerHTML = "ERROR LOADING DATA"; }
        }

        function parseSettings(csv) {
            const rows = csv.split('\n').map(r => r.split(',').map(c => c.replace(/"/g,'').trim()));
            rows.forEach(r => {
                if(r[0] === 'ShopName_fa') config.names['fa'] = r[1];
                if(r[0] === 'ShopName_en') config.names['en'] = r[1];
                if(r[0] === 'ShopName_ar') config.names['ar'] = r[1];
                if(r[0] === 'HeaderImage') document.documentElement.style.setProperty('--header-img', `url('${r[1]}')`);
                if(r[0] === 'BgImage') document.documentElement.style.setProperty('--bg-img', `url('${r[1]}')`);
                if(r[0] === 'Phone') config.phone = r[1];
                if(r[0] === 'DeliveryPrice') config.deliveryPrice = parseInt(r[1]) || 0;
                if(r[0] === 'PaymentLink') config.paymentLink = r[1];
                if(r[0] === 'IsOpen') config.isOpen = r[1].toUpperCase() !== 'FALSE';
            });
        }

        function parseMenu(csv) {
            const rows = csv.split('\n');
            const headers = rows[0].split(',').map(h => h.replace(/"/g, '').trim());
            
            rows.slice(1).forEach((r, i) => {
                const cols = r.split(',').map(x => x.replace(/"/g, '').trim());
                if(cols.length < 3) return;
                
                // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù…Ø­ØªÙˆØ§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‡Ø¯Ø±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø´ÛŒØª
                products.push({
                    id: i,
                    cat: { fa: cols[0], en: cols[1] || cols[0], ar: cols[2] || cols[0] },
                    title: { fa: cols[3], en: cols[4] || cols[3], ar: cols[5] || cols[3] },
                    price: parseInt(cols[6].replace(/,/g,'')),
                    img: cols[7],
                    active: cols[8]?.toUpperCase() !== 'FALSE'
                });
            });
        }

        function renderMenu(cat) {
            currentCat = cat;
            const t = translations[curLang], list = document.getElementById('list'), catsDiv = document.getElementById('cats');
            
            // Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ (ØªØ±Ø¬Ù…Ù‡ Ø´Ø¯Ù‡)
            const catSet = ['all', ...new Set(products.map(p => p.cat[curLang]))];
            catsDiv.innerHTML = catSet.map(c => `<div class="cat-btn ${ (cat === 'all' && c === 'all') || (cat === c) ? 'active' : '' }" onclick="renderMenu('${c}')">${c==='all'?t.all:c}</div>`).join('');
            
            list.innerHTML = '';
            products.filter(p => cat === 'all' || p.cat[curLang] === cat).forEach(p => {
                const count = cart[p.id] || 0;
                const btn = !p.active ? `<span style="color:#e74c3c;">${t.out}</span>` : 
                    (count === 0 ? `<div class="add-btn" onclick="updateCart(${p.id}, 1)">${t.add}</div>` : 
                    `<div class="qty-box show"><div class="q-btn" onclick="updateCart(${p.id}, 1)">+</div><span style="padding:0 8px">${count}</span><div class="q-btn" onclick="updateCart(${p.id}, -1)">-</div></div>`);
                list.innerHTML += `<div class="item"><img src="${p.img}"><div class="info"><h3>${p.title[curLang]}</h3><div style="display:flex;justify-content:space-between;margin-top:5px;align-items:center;"><span class="price">${p.price.toLocaleString()}</span>${btn}</div></div></div>`;
            });
        }

        window.updateCart = (id, n) => { if(!config.isOpen) return; cart[id] = (cart[id] || 0) + n; if(cart[id]<=0) delete cart[id]; renderMenu(currentCat); };

        function calcTotal() {
            let total = 0, count = 0, sumHtml = '', t = translations[curLang];
            for(let id in cart) { 
                const p = products[id]; total += p.price * cart[id]; count += cart[id];
                sumHtml += `<div class="summary-item"><span>${p.title[curLang]}</span><div class="qty-box"><div class="q-btn" onclick="updateCart(${id},-1)">-</div><span style="padding:0 10px">${cart[id]}</span><div class="q-btn" onclick="updateCart(${id},1)">+</div></div><span>${(p.price * cart[id]).toLocaleString()}</span></div>`;
            }
            let isDel = document.getElementById('btn-delivery').classList.contains('selected');
            let final = isDel ? total + config.deliveryPrice : total;
            document.getElementById('itemsTotal').innerText = total.toLocaleString();
            document.getElementById('finalPayable').innerText = final.toLocaleString() + " " + t.unit;
            document.getElementById('summaryList').innerHTML = sumHtml || `<p style="text-align:center; opacity:0.5;">${t.empty}</p>`;
            
            const bar = document.getElementById('cartBar'), details = document.getElementById('orderDetails');
            bar.style.display = count > 0 ? 'flex' : 'none';
            document.getElementById('actionBtn').innerText = details.classList.contains('active') ? (isDel ? t.payBtn : t.submitBtn) : t.viewBtn;
        }

        window.setMode = (type) => {
            document.getElementById('btn-table').classList.toggle('selected', type === 'table');
            document.getElementById('btn-delivery').classList.toggle('selected', type === 'delivery');
            document.getElementById('form-table').classList.toggle('hidden', type !== 'table');
            document.getElementById('form-delivery').classList.toggle('hidden', type !== 'delivery');
            document.getElementById('deliveryRow').style.display = type === 'delivery' ? 'flex' : 'none';
            calcTotal();
        };

        window.processOrder = () => {
            const t = translations[curLang]; if(!config.isOpen) return;
            const det = document.getElementById('orderDetails');
            if (!det.classList.contains('active')) { det.classList.add('active'); calcTotal(); return; }
            
            let desc = ""; for(let id in cart) desc += `${products[id].title[curLang]}(${cart[id]}) - `;
            if(document.getElementById('btn-table').classList.contains('selected')) {
                const n = document.getElementById('tableNum').value; if(!n) return alert(curLang === 'en' ? 'Table Number?' : 'Ø´Ù…Ø§Ø±Ù‡ Ù…ÛŒØ²ØŸ');
                window.open(`https://wa.me/${config.phone}?text=${encodeURIComponent('Order Table ' + n + ": " + desc)}`);
            } else {
                if(confirm(t.confirm.replace('{amount}', document.getElementById('finalPayable').innerText))) window.location.href = config.paymentLink;
            }
        };

        window.closeOrderWindow = () => { document.getElementById('orderDetails').classList.remove('active'); calcTotal(); };
        startApp();
    </script>
</body>
</html>
