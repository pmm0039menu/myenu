<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø³ÙØ§Ø±Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
    <style>
        /* --- Ù‡Ù…Ø§Ù† Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ --- */
        :root { --primary: #d3ad7f; --bg: #13131a; --card: #1e1e24; --text: #ffffff; --green: #27ae60; --blue: #2980b9; --input-bg: #2a2a35; }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Tahoma', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background:var(--bg); color:var(--text); padding-bottom:100px; user-select: none; }
        header { background: var(--card); padding: 20px; text-align: center; border-bottom: 2px solid var(--primary); position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        header h1 { font-size: 1.5rem; color: var(--primary); margin-bottom: 5px; }
        .cat-scroll { display: flex; gap: 10px; padding: 15px; overflow-x: auto; background: #0b0b0f; }
        .cat-btn { background: var(--card); color: #fff; padding: 8px 16px; border-radius: 20px; border: 1px solid #333; white-space: nowrap; cursor: pointer; transition: 0.3s; }
        .cat-btn.active { background: var(--primary); border-color: var(--primary); color: #000; font-weight: bold; }
        .menu-list { padding: 15px; max-width: 600px; margin: 0 auto; min-height: 300px; }
        .item { background: var(--card); border-radius: 12px; padding: 10px; margin-bottom: 12px; display: flex; gap: 12px; border: 1px solid #2a2a35; align-items: center; animation: fadeIn 0.5s; }
        .item img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; border: 1px solid var(--primary); background: #000; }
        .info { flex: 1; }
        .info h3 { font-size: 1rem; margin-bottom: 4px; }
        .price { color: var(--primary); font-weight: bold; font-size: 1.1rem; }
        .add-btn { background: #333; color: #fff; padding: 6px 15px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; }
        .qty-box { display: none; align-items: center; background: #000; border-radius: 6px; border: 1px solid var(--primary); }
        .qty-box.show { display: flex; }
        .q-btn { width: 35px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; }
        .q-num { width: 25px; text-align: center; font-weight: bold; font-size: 1rem; }
        .order-details { background: var(--card); padding: 15px; border-top: 2px solid var(--primary); position: fixed; bottom: 80px; left: 0; right: 0; z-index: 900; display: none; max-width: 600px; margin: 0 auto; border-radius: 15px 15px 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); overflow-y: auto; max-height: 70vh; }
        .order-details.active { display: block; }
        .type-selector { display: flex; gap: 10px; margin-bottom: 15px; }
        .type-btn { flex: 1; padding: 10px; background: #000; border: 1px solid #333; color: #888; text-align: center; border-radius: 8px; cursor: pointer; }
        .type-btn.selected { background: var(--primary); color: #000; font-weight: bold; border-color: var(--primary); }
        .input-group { margin-bottom: 8px; }
        .input-group input, .input-group textarea { width: 100%; padding: 10px; background: var(--input-bg); border: 1px solid #333; color: #fff; border-radius: 8px; outline: none; }
        .input-group textarea { resize: none; height: 60px; }
        .hidden { display: none !important; }
        .invoice-box { background: #111; padding: 10px; border-radius: 8px; margin-bottom: 15px; }
        .invoice-row { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; padding: 0 5px; color: #ccc; }
        .invoice-row.highlight { color: var(--primary); font-weight: bold; border-top: 1px solid #333; padding-top: 5px; margin-top: 5px; font-size: 1.1rem; }
        .cart-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #000; padding: 15px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; border-top: 1px solid #333; }
        .final-btn { background: var(--green); color: #fff; padding: 12px; border-radius: 12px; font-weight: bold; box-shadow: 0 0 10px rgba(39, 174, 96, 0.4); cursor: pointer; font-size: 1rem; text-align: center; width: 100%; }
        .pay-btn { background: var(--blue); box-shadow: 0 0 10px rgba(41, 128, 185, 0.4); }
        
        /* ÙÙˆØªØ± Ø³Ø§Ø²Ù†Ø¯Ù‡ */
        .dev-footer { text-align: center; margin-top: 40px; padding: 20px 20px 100px 20px; border-top: 1px solid #222; color: #666; font-size: 0.75rem; }
        .dev-icons { display: flex; justify-content: center; gap: 15px; margin-top: 10px; }
        .dev-icons a { display: inline-flex; align-items: center; justify-content: center; width: 32px; height: 32px; background: #1a1a1a; border-radius: 50%; color: #aaa; border: 1px solid #333; transition: 0.3s; }
        .dev-icons a:hover { background: #d3ad7f; color: #000; border-color: #d3ad7f; }
        .dev-icons svg { width: 16px; height: 16px; fill: currentColor; }
        
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    </style>
</head>
<body>

    <header>
        <h1 id="shopName">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</h1>
        <p>Ø³ÙØ§Ø±Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ†</p>
    </header>

    <div class="cat-scroll" id="cats"></div>

    <div class="menu-list" id="list">
        <p style="text-align:center; color:#666; margin-top:50px;" id="loadingText">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</p>
    </div>

    <div class="dev-footer">
        <p>Ù…Ø¬Ø±ÛŒ Ø·Ø±Ø­ (Ù…ÙØ¬Ø¯)</p>
        <div class="dev-icons">
            <a href="tel:09123456789"><svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg></a>
            </div>
    </div>

    <div class="order-details" id="orderDetails">
        <div class="type-selector">
            <div class="type-btn selected" onclick="setOrderType('table')" id="btn-table">ğŸ½ï¸ Ø¯Ø§Ø®Ù„ Ø³Ø§Ù„Ù†</div>
            <div class="type-btn" onclick="setOrderType('delivery')" id="btn-delivery">ğŸ›µ Ø¨ÛŒØ±ÙˆÙ†â€ŒØ¨Ø±</div>
        </div>

        <div class="invoice-box">
            <div class="invoice-row"><span>Ø¬Ù…Ø¹ Ø§Ù‚Ù„Ø§Ù…:</span><span id="itemsTotal">0</span></div>
            <div class="invoice-row" id="deliveryRow" style="display: none;"><span>Ù‡Ø²ÛŒÙ†Ù‡ Ù¾ÛŒÚ©:</span><span id="deliveryPriceDisplay">0</span></div>
            <div class="invoice-row highlight"><span>Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:</span><span id="finalPayable">0</span></div>
        </div>

        <div class="input-group"><textarea id="userNote" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø³ÙØ§Ø±Ø´ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)..."></textarea></div>
        <div id="form-table" class="input-group"><input type="number" id="tableNum" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÛŒØ²"></div>
        <div id="form-delivery" class="hidden">
            <div class="input-group"><input type="tel" id="userPhone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³"></div>
            <div class="input-group"><textarea id="address" placeholder="Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚..."></textarea></div>
        </div>
    </div>

    <div class="cart-bar" id="cartBar" style="display:none">
        <div class="final-btn" id="actionBtn" onclick="processOrder()">ØªÚ©Ù…ÛŒÙ„ Ø³ÙØ§Ø±Ø´</div>
    </div>

    <script>
        // === ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø§ÛŒÙ‡ (Ø³Ù…Øª Ø´Ù…Ø§) ===
        // Ù„ÛŒÙ†Ú© Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø®ÙˆØ¯ØªØ§Ù† (Ø¨Ø¯ÙˆÙ† Ù…Ø¨Ù„Øº)
        const MY_PAYMENT_LINK = "https://idpay.ir/YOUR_ID?amount=";
        const RENEWAL_LINK = "https://idpay.ir/YOUR_ID_FOR_RENEWAL"; 
        
        let products = [];
        let categories = [];
        let config = { name: "ÙØ±ÙˆØ´Ú¯Ø§Ù‡", deliveryPrice: 30000, phone: "" };
        let cart = {};
        let orderType = 'table';

        // 1. Ø®ÙˆØ§Ù†Ø¯Ù† Ø¢ÛŒØ¯ÛŒ Ø´ÛŒØª Ø§Ø² Ø¢Ø¯Ø±Ø³ URL
        // Ù…Ø«Ø§Ù„: site.com/?id=XXXXXXXX
        const urlParams = new URLSearchParams(window.location.search);
        const sheetId = urlParams.get('id');

        async function startApp() {
            if (!sheetId) {
                document.getElementById('list').innerHTML = `<div style="text-align:center; padding:30px; color:#e74c3c">â›” Ø´Ù†Ø§Ø³Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.<br>Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù„ÛŒÙ†Ú© Ø§Ø®ØªØµØ§ØµÛŒ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.</div>`;
                return;
            }

            try {
                // 2. Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ†Ø¸ÛŒÙ…Ø§Øª (ØªØ¨ Settings)
                // ØªÙˆØ¬Ù‡: gid=0 Ù…Ø¹Ù…ÙˆÙ„Ø§ ØªØ¨ Ø§ÙˆÙ„ Ø§Ø³ØªØŒ Ø¨Ø§ÛŒØ¯ gid ØªØ¨ Settings Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯ ÛŒØ§ ØªØ±ØªÛŒØ¨ Ø±Ø§ Ø±Ø¹Ø§ÛŒØª Ú©Ù†ÛŒØ¯.
                // ÙØ±Ø¶ Ù…ÛŒÚ©Ù†ÛŒÙ… ØªØ¨ Ø§ÙˆÙ„ (gid=0) Ù…Ù†Ùˆ Ø§Ø³Øª Ùˆ ØªØ¨ Ø¯ÙˆÙ… ØªÙ†Ø¸ÛŒÙ…Ø§Øª.
                // Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ: Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø±Ø§ Ø¯Ø± ÛŒÚ© Ù…Ù†Ø·Ù‚ CSV Ù¾Ø§Ø±Ø³ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ú¯ÙˆÚ¯Ù„ Ø´ÛŒØª (ÙØ±Ù…Øª CSV)
                const menuCsv = await fetch(`https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=Menu`);
                const settingsCsv = await fetch(`https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=Settings`);
                
                if(!menuCsv.ok || !settingsCsv.ok) throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„");

                const menuText = await menuCsv.text();
                const settingsText = await settingsCsv.text();

                parseSettings(settingsText);
                parseMenu(menuText);

            } catch (err) {
                console.error(err);
                document.getElementById('list').innerHTML = `<div style="text-align:center; padding:30px; color:#e74c3c">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª.<br>Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ø´Ù†Ø§Ø³Ù‡ ØµØ­ÛŒØ­ Ø¨Ø§Ø´Ø¯ Ùˆ Ø´ÛŒØª Publish Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯.</div>`;
            }
        }

        // ØªØ¬Ø²ÛŒÙ‡ Ùˆ ØªØ­Ù„ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ùˆ Ø§Ø´ØªØ±Ø§Ú©
        function parseSettings(csvText) {
            const rows = csvToArr(csvText);
            let settingsMap = {};
            rows.forEach(r => { if(r[0]) settingsMap[r[0]] = r[1]; });

            // Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø§Ù… ÙØ±ÙˆØ´Ú¯Ø§Ù‡
            if(settingsMap['ShopName']) {
                config.name = settingsMap['ShopName'].replace(/"/g, '');
                document.getElementById('shopName').innerText = config.name;
                document.title = config.name;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³
             if(settingsMap['Phone']) config.phone = settingsMap['Phone'];

            // === Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø´ØªØ±Ø§Ú© (Ù…Ù‡Ù…) ===
            if(settingsMap['ExpireDate']) {
                const expireDate = new Date(settingsMap['ExpireDate'].replace(/"/g, ''));
                const today = new Date();
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø§Ù†Ø¯Ù‡
                const diffTime = expireDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

                if (diffDays <= 0) {
                    blockAccess(); // Ù‚ÙÙ„ Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒØª
                    throw new Error("Expired"); // ØªÙˆÙ‚Ù Ø¨Ø±Ù†Ø§Ù…Ù‡
                } else {
                    // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¬ Ø§Ø¹ØªØ¨Ø§Ø±
                    showBadge(diffDays);
                }
            }
        }

        // ØªØ¬Ø²ÛŒÙ‡ Ù…Ù†Ùˆ
        function parseMenu(csvText) {
            const rows = csvToArr(csvText);
            // Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„ Ù‡Ø¯Ø± Ø§Ø³ØªØŒ Ø±Ø¯ Ù…ÛŒ Ú©Ù†ÛŒÙ…
            
            let tempCats = new Set();
            
            // Ø³ØªÙˆÙ†â€ŒÙ‡Ø§: 0:Cat | 1:Name | 2:Price | 3:Image | 4:Active
            for(let i=1; i<rows.length; i++) {
                const r = rows[i];
                if(r.length < 3) continue;
                
                // Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ (Active) ØªÛŒÚ© Ù†Ø¯Ø§Ø´Øª (FALSE) Ø±Ø¯ Ú©Ù†
                const isActive = r[4] ? r[4].toUpperCase().includes('TRUE') : true;
                if(!isActive) continue;

                const cat = r[0].replace(/"/g, '');
                tempCats.add(cat);
                
                products.push({
                    id: i,
                    c: cat,
                    t: r[1].replace(/"/g, ''),
                    p: parseInt(r[2].replace(/,/g, '')),
                    i: r[3] ? r[3].replace(/"/g, '') : ''
                });
            }

            // Ø³Ø§Ø®Øª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡ Ø¨Ù†Ø¯ÛŒ
            let catHtml = `<div class="cat-btn active" onclick="filter('all', this)">Ù‡Ù…Ù‡</div>`;
            tempCats.forEach(c => {
                catHtml += `<div class="cat-btn" onclick="filter('${c}', this)">${c}</div>`;
            });
            document.getElementById('cats').innerHTML = catHtml;
            
            render('all');
        }

        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ØªØ¨Ø¯ÛŒÙ„ CSV Ø¨Ù‡ Ø¢Ø±Ø§ÛŒÙ‡
        function csvToArr(strData) {
            const rows = [];
            let currentRow = [];
            let currentVal = '';
            let insideQuote = false;
            
            for(let i=0; i<strData.length; i++) {
                const char = strData[i];
                if(char === '"') { insideQuote = !insideQuote; }
                else if(char === ',' && !insideQuote) { currentRow.push(currentVal); currentVal = ''; }
                else if(char === '\n' && !insideQuote) { 
                    currentRow.push(currentVal); rows.push(currentRow); currentRow = []; currentVal = ''; 
                } else { currentVal += char; }
            }
            if(currentVal) currentRow.push(currentVal);
            if(currentRow.length) rows.push(currentRow);
            return rows;
        }

        function showBadge(days) {
            const badge = document.createElement('div');
            const color = days < 10 ? '#e74c3c' : '#27ae60';
            badge.style.cssText = `position:fixed;top:10px;left:10px;background:rgba(0,0,0,0.7);border:1px solid ${color};color:${color};padding:5px 10px;border-radius:20px;font-size:0.7rem;z-index:9999;font-weight:bold;`;
            badge.innerHTML = `ğŸ“… Ø§Ø¹ØªØ¨Ø§Ø±: ${days} Ø±ÙˆØ²`;
            document.body.appendChild(badge);
        }

        function blockAccess() {
            document.body.innerHTML = ""; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù„ ØµÙØ­Ù‡
            document.body.style.background = "#000";
            document.body.style.display = "flex";
            document.body.style.justifyContent = "center";
            document.body.style.alignItems = "center";
            document.body.style.height = "100vh";
            document.body.style.flexDirection = "column";
            
            document.body.innerHTML = `
                <div style="text-align:center; color:#fff;">
                    <h1 style="color:#e74c3c; margin-bottom:20px;">Ù¾Ø§ÛŒØ§Ù† Ø§Ø´ØªØ±Ø§Ú©</h1>
                    <p>Ø§Ø´ØªØ±Ø§Ú© Ø§ÛŒÙ† Ù…Ù†Ùˆ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯Ù‡ Ø§Ø³Øª.</p>
                    <a href="${RENEWAL_LINK}" style="display:inline-block; margin-top:20px; background:#27ae60; color:#fff; padding:10px 20px; text-decoration:none; border-radius:10px;">ØªÙ…Ø¯ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú©</a>
                </div>
            `;
        }

        // --- ØªÙˆØ§Ø¨Ø¹ Ø±Ù†Ø¯Ø±ÛŒÙ†Ú¯ Ùˆ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ (Ù‡Ù…Ø§Ù† Ù…Ù†Ø·Ù‚ Ù‚Ø¨Ù„ÛŒ) ---
        function render(cat) {
            const list = document.getElementById('list');
            list.innerHTML = '';
            const items = cat === 'all' ? products : products.filter(x => x.c === cat);
            
            if(items.length === 0) { list.innerHTML = '<p style="text-align:center; color:#666; margin-top:30px">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>'; return; }

            items.forEach(x => {
                const count = cart[x.id] || 0;
                let btnHtml = count === 0 
                    ? `<div class="add-btn" onclick="upd(${x.id}, 1)">Ø§ÙØ²ÙˆØ¯Ù†</div>` 
                    : `<div class="qty-box show"><div class="q-btn" onclick="upd(${x.id}, 1)">+</div><div class="q-num">${count}</div><div class="q-btn" onclick="upd(${x.id}, -1)">-</div></div>`;
                
                list.innerHTML += `
                <div class="item">
                    <img src="${x.i}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1170/1170576.png'">
                    <div class="info">
                        <h3>${x.t}</h3>
                        <div style="display:flex; justify-content:space-between; margin-top:5px; align-items:center;">
                            <span class="price">${x.p.toLocaleString()}</span>${btnHtml}
                        </div>
                    </div>
                </div>`;
            });
            calcTotal();
        }

        window.filter = (cat, el) => {
            document.querySelectorAll('.cat-btn').forEach(x=>x.classList.remove('active'));
            el.classList.add('active');
            render(cat);
        };

        window.upd = (id, n) => {
            if(!cart[id]) cart[id]=0;
            cart[id]+=n;
            if(cart[id]<=0) delete cart[id];
            
            calcTotal();
            const activeBtn = document.querySelector('.cat-btn.active');
            const currentCat = activeBtn ? activeBtn.innerText === 'Ù‡Ù…Ù‡' ? 'all' : activeBtn.innerText : 'all';
            render(currentCat);
        };

        function calcTotal() {
            let total = 0, count = 0;
            for(let id in cart) {
                const p = products.find(x=>x.id==id);
                if(p) { total += p.p * cart[id]; count += cart[id]; }
            }
            let final = orderType === 'delivery' ? total + config.deliveryPrice : total;
            
            document.getElementById('itemsTotal').innerText = total.toLocaleString();
            document.getElementById('deliveryPriceDisplay').innerText = config.deliveryPrice.toLocaleString();
            document.getElementById('finalPayable').innerText = final.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';
            
            const bar = document.getElementById('cartBar');
            const details = document.getElementById('orderDetails');
            if(count>0) { bar.style.display='flex'; details.classList.add('active'); }
            else { bar.style.display='none'; details.classList.remove('active'); }
            
            updateBtn(final);
        }

        window.setOrderType = (type) => {
            orderType = type;
            document.getElementById('btn-table').classList.remove('selected');
            document.getElementById('btn-delivery').classList.remove('selected');
            document.getElementById('btn-'+type).classList.add('selected');
            
            if(type === 'table') {
                document.getElementById('form-table').classList.remove('hidden');
                document.getElementById('form-delivery').classList.add('hidden');
                document.getElementById('deliveryRow').style.display='none';
            } else {
                document.getElementById('form-table').classList.add('hidden');
                document.getElementById('form-delivery').classList.remove('hidden');
                document.getElementById('deliveryRow').style.display='flex';
            }
            calcTotal();
        };

        function updateBtn(price) {
            const btn = document.getElementById('actionBtn');
            if(orderType === 'delivery') {
                btn.innerHTML = `ğŸ’³ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ù†Ù„Ø§ÛŒÙ† (${price.toLocaleString()})`;
                btn.style.background = "var(--blue)";
            } else {
                btn.innerHTML = `âœ… Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø³Ø§Ù„Ù†`;
                btn.style.background = "var(--green)";
            }
        }

        window.processOrder = () => {
            let desc = "";
            let total = 0;
            for(let id in cart) {
                const p = products.find(x=>x.id==id);
                if(p) { total += p.p * cart[id]; desc += `${p.t}(${cart[id]}) - `; }
            }
            const note = document.getElementById('userNote').value;
            if(note) desc += `\nØªÙˆØ¶ÛŒØ­Ø§Øª: ${note}`;
            
            if(orderType === 'table') {
                const tNum = document.getElementById('tableNum').value;
                if(!tNum) return alert('Ø´Ù…Ø§Ø±Ù‡ Ù…ÛŒØ²ØŸ');
                window.open(`https://wa.me/${config.phone}?text=${encodeURIComponent(`Ø³ÙØ§Ø±Ø´ Ø³Ø§Ù„Ù†\nÙ…ÛŒØ²: ${tNum}\n${desc}`)}`);
            } else {
                const ph = document.getElementById('userPhone').value;
                const ad = document.getElementById('address').value;
                if(!ph || !ad) return alert('Ø¢Ø¯Ø±Ø³ Ùˆ ØªÙ„ÙÙ†ØŸ');
                
                const finalPrice = (total + config.deliveryPrice) * 10; // Ø±ÛŒØ§Ù„
                const payUrl = `${MY_PAYMENT_LINK}${finalPrice}&desc=${encodeURIComponent(ph + '|' + desc)}`;
                window.location.href = payUrl;
            }
        };

        // Ø§Ø³ØªØ§Ø±Øª
        startApp();
    </script>
</body>
</html>
