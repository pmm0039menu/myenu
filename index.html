<!DOCTYPE html>
<html lang="fa" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ŸÖŸÜŸà€å ÿ¢ŸÜŸÑÿß€åŸÜ</title>
    <style>
        :root { 
            --primary: #d3ad7f; --bg: #13131a; --card: #1e1e24; --text: #ffffff; --green: #27ae60; --blue: #2980b9; --input-bg: #2a2a35; 
            --header-img: url('https://images.unsplash.com/photo-1513104890138-7c749659a591?auto=format&fit=crop&w=1000&q=80');
            --bg-img: url('https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&w=1000&q=80');
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Tahoma', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: linear-gradient(rgba(19, 19, 26, 0.85), rgba(19, 19, 26, 0.85)), var(--bg-img);
            background-size: cover; background-attachment: fixed; background-position: center;
            color:var(--text); padding-bottom:120px; user-select: none; 
        }
        
        header { 
            background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), var(--header-img);
            background-size: cover; background-position: center;
            padding: 50px 20px; text-align: center; border-bottom: 3px solid var(--primary); 
            position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.6); 
        }

        .lang-switch { position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; z-index: 101; }
        .lang-btn { background: rgba(0,0,0,0.6); border: 1px solid var(--primary); color: #fff; padding: 4px 8px; border-radius: 5px; font-size: 0.7rem; cursor: pointer; }
        .lang-btn.active { background: var(--primary); color: #000; }

        header h1 { font-size: 1.8rem; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); margin-bottom: 5px; }
        .status-badge { font-size: 0.85rem; padding: 5px 12px; border-radius: 12px; display: inline-block; margin-top: 5px; font-weight: bold; }
        .open { background: #27ae60; color: #fff; }
        .closed { background: #c0392b; color: #fff; }
        .sub-badge { position: fixed; top: 15px; left: 15px; background: rgba(0,0,0,0.8); border: 1px solid var(--primary); color: var(--primary); padding: 5px 10px; border-radius: 15px; font-size: 0.75rem; z-index: 1000; font-weight: bold; backdrop-filter: blur(5px); }
        
        .cat-scroll { display: flex; gap: 10px; padding: 15px; overflow-x: auto; background: rgba(11, 11, 15, 0.8); backdrop-filter: blur(5px); }
        .cat-btn { background: var(--card); color: #fff; padding: 8px 16px; border-radius: 20px; border: 1px solid #333; white-space: nowrap; cursor: pointer; transition: 0.3s; }
        .cat-btn.active { background: var(--primary); border-color: var(--primary); color: #000; font-weight: bold; }

        .menu-list { padding: 15px; max-width: 600px; margin: 0 auto; min-height: 300px; }
        .item { background: rgba(30, 30, 36, 0.9); border-radius: 12px; padding: 10px; margin-bottom: 12px; display: flex; gap: 12px; border: 1px solid #2a2a35; align-items: center; animation: fadeIn 0.5s; position: relative; }
        .item img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; border: 1px solid var(--primary); background: #000; }
        .info { flex: 1; }
        .info h3 { font-size: 1rem; margin-bottom: 4px; }
        .price { color: var(--primary); font-weight: bold; font-size: 1.1rem; }
        
        .add-btn { background: #333; color: #fff; padding: 6px 15px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; }
        .qty-box { display: none; align-items: center; background: #000; border-radius: 6px; border: 1px solid var(--primary); }
        .qty-box.show { display: flex; }
        .q-btn { width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; }
        .q-num { width: 25px; text-align: center; font-weight: bold; font-size: 1rem; }

        .order-details { background: var(--card); padding: 15px; border-top: 2px solid var(--primary); position: fixed; bottom: 80px; left: 0; right: 0; z-index: 900; display: none; max-width: 600px; margin: 0 auto; border-radius: 15px 15px 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); overflow-y: auto; max-height: 70vh; position: relative; }
        .order-details.active { display: block; }
        .close-details { position: absolute; top: 15px; left: 15px; width: 30px; height: 30px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; cursor: pointer; border: 1px solid var(--primary); z-index: 10; }

        .type-selector { display: flex; gap: 10px; margin: 15px 0; }
        .type-btn { flex: 1; padding: 10px; background: #000; border: 1px solid #333; color: #888; text-align: center; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .type-btn.selected { background: var(--primary); color: #000; border-color: var(--primary); }

        .invoice-box { background: #111; padding: 10px; border-radius: 8px; margin-bottom: 15px; }
        .invoice-row { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; padding: 0 5px; color: #ccc; }
        .invoice-row.highlight { color: var(--primary); font-weight: bold; border-top: 1px solid #333; padding-top: 5px; margin-top: 5px; font-size: 1.1rem; }
        
        .summary-list { border-bottom: 1px solid #333; margin-bottom: 15px; padding-bottom: 10px; }
        .summary-item { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; margin-bottom: 12px; color: #eee; }
        .summary-controls { flex: 1.5; display: flex; align-items: center; justify-content: center; gap: 8px; background: #000; border-radius: 6px; border: 1px solid #444; padding: 2px 5px; margin: 0 10px; }
        .s-btn { color: var(--primary); font-weight: bold; font-size: 1.2rem; cursor: pointer; padding: 0 5px; }

        .input-group { margin-bottom: 10px; }
        .input-group input, .input-group textarea { width: 100%; padding: 12px; background: var(--input-bg); border: 1px solid #333; color: #fff; border-radius: 8px; outline: none; font-size: 0.9rem; }

        .cart-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #000; padding: 15px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; border-top: 1px solid #333; }
        .final-btn { background: var(--green); color: #fff; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1rem; text-align: center; width: 100%; }

        .dev-footer { text-align: center; margin-top: 40px; padding: 30px 20px 100px 20px; border-top: 1px solid rgba(211, 173, 127, 0.2); background: rgba(14, 14, 18, 0.95); position: relative; z-index: 10; }
        .dev-icons { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        .dev-icons a { display: inline-flex; align-items: center; justify-content: center; width: 42px; height: 42px; background: #1a1a1a; border-radius: 50%; color: var(--primary); border: 1px solid var(--primary); text-decoration: none; }
        
        #lockScreen { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #000; z-index: 9999; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
        .hidden { display: none !important; }

        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    </style>
</head>
<body>

    <div class="lang-switch">
        <div class="lang-btn active" id="btn-fa" onclick="changeLang('fa')">FA</div>
        <div class="lang-btn" id="btn-en" onclick="changeLang('en')">EN</div>
        <div class="lang-btn" id="btn-ar" onclick="changeLang('ar')">AR</div>
    </div>

    <div id="lockScreen">
        <h2 id="lockTitle" style="color:#e74c3c">Ÿæÿß€åÿßŸÜ ÿßÿ¥ÿ™ÿ±ÿß⁄© ‚ö†Ô∏è</h2>
        <p id="lockMsg1">ŸÖŸáŸÑÿ™ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ÿß€åŸÜ ŸÖŸÜŸà€å ÿØ€åÿ¨€åÿ™ÿßŸÑ ÿ®Ÿá Ÿæÿß€åÿßŸÜ ÿ±ÿ≥€åÿØŸá ÿßÿ≥ÿ™.</p>
        <p id="lockMsg2">ÿ¨Ÿáÿ™ ÿ™ŸÖÿØ€åÿØ ÿßÿ¥ÿ™ÿ±ÿß⁄© ÿ®ÿß Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ÿ™ŸÖÿßÿ≥ ÿ®⁄Ø€åÿ±€åÿØ.</p>
        <div class="dev-icons" style="margin-top:20px;">
             <a href="tel:09123456789"><svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z" fill="currentColor"/></svg></a>
        </div>
    </div>

    <div id="subBadge" class="sub-badge"></div>

    <header>
        <h1 id="shopName">...</h1>
        <div id="shopStatus" class="status-badge">...</div>
    </header>

    <div class="cat-scroll" id="cats"></div>

    <div class="menu-list" id="list">
        <p style="text-align:center; color:#fff; margin-top:50px;" id="loadingText">...</p>
    </div>

    <div class="dev-footer">
        <p class="dev-title" id="devTitle" style="color: #fff; font-weight: bold;">ŸÖÿ¨ÿ±€å ÿ∑ÿ±ÿ≠: ⁄Øÿ±ŸàŸá ŸÜÿ±ŸÖ‚ÄåÿßŸÅÿ≤ÿßÿ±€å ŸÖŸéÿ¨ÿØ</p>
        <div class="dev-icons">
            <a href="tel:09123456789"><svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg></a>
            <a href="https://t.me/YOUR_ID"><svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.75-.33 1.42.2 1.17 1.38l-2.75 12.96c-.2.9-1.52.84-2.1.28l-5.31-4.22-2.58 2.48c-.28.28-.52.51-1.06.51l.39-3.98z"/></svg></a>
            <a href="https://wa.me/989123456789"><svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01C17.18 3.03 14.69 2 12.04 2zM12.05 19.81c-1.48 0-2.93-.4-4.21-1.15l-.3-.18-3.11.82.83-3.04-.19-.31c-.82-1.31-1.26-2.83-1.26-4.38 0-4.54 3.7-8.24 8.24-8.24 2.2 0 4.27.86 5.82 2.42 1.56 1.56 2.41 3.63 2.41 5.83 0 4.54-3.69 8.23-8.23 8.23z"/></svg></a>
        </div>
    </div>

    <div class="order-details" id="orderDetails">
        <div class="close-details" onclick="closeDetails()">‚úï</div>
        <h3 id="reviewTitle" style="margin-bottom:10px; color:var(--primary); font-size:1rem; text-align:center;">ÿ®ÿßÿ≤ÿ®€åŸÜ€å ÿ≥ŸÅÿßÿ±ÿ¥</h3>
        <div id="summaryList" class="summary-list"></div>
        <div class="type-selector">
            <div class="type-btn selected" onclick="setOrderType('table')" id="btn-table">üçΩÔ∏è ÿ≥ÿßŸÑŸÜ</div>
            <div class="type-btn" onclick="setOrderType('delivery')" id="btn-delivery">üõµ ÿ®€åÿ±ŸàŸÜ‚Äåÿ®ÿ±</div>
        </div>
        <div class="invoice-box">
            <div class="invoice-row"><span id="txtItemsTotal">ÿ¨ŸÖÿπ ÿßŸÇŸÑÿßŸÖ:</span><span id="itemsTotal">0</span></div>
            <div class="invoice-row" id="deliveryRow" style="display: none;"><span id="txtDelPrice">Ÿáÿ≤€åŸÜŸá Ÿæ€å⁄©:</span><span id="deliveryPriceDisplay">0</span></div>
            <div class="invoice-row highlight"><span id="txtFinal">ŸÇÿßÿ®ŸÑ Ÿæÿ±ÿØÿßÿÆÿ™:</span><span id="finalPayable">0</span></div>
        </div>
        <div class="input-group"><textarea id="userNote" placeholder=""></textarea></div>
        <div id="form-table" class="input-group"><input type="number" id="tableNum" placeholder=""></div>
        <div id="form-delivery" class="hidden">
            <div class="input-group"><input type="tel" id="userPhone" placeholder=""></div>
            <div class="input-group"><textarea id="address" placeholder=""></textarea></div>
        </div>
    </div>

    <div class="cart-bar" id="cartBar" style="display:none">
        <div class="final-btn" id="actionBtn" onclick="processOrder()">...</div>
    </div>

    <script>
        const translations = {
            fa: {
                open: "‚úÖ ÿ®ÿßÿ≤ ÿßÿ≥ÿ™", closed: "‚õî ÿ®ÿ≥ÿ™Ÿá ÿßÿ≥ÿ™", loading: "ÿØÿ± ÿ≠ÿßŸÑ ÿØÿ±€åÿßŸÅÿ™ ŸÖŸÜŸà...", all: "ŸáŸÖŸá", add: "ÿßŸÅÿ≤ŸàÿØŸÜ", out: "ŸÜÿßŸÖŸàÿ¨ŸàÿØ",
                review: "üìã ÿ®ÿßÿ≤ÿ®€åŸÜ€å ÿ≥ŸÅÿßÿ±ÿ¥", table: "üçΩÔ∏è ÿ≥ÿßŸÑŸÜ", delivery: "üõµ ÿ®€åÿ±ŸàŸÜ‚Äåÿ®ÿ±", total: "ÿ¨ŸÖÿπ ÿßŸÇŸÑÿßŸÖ:", courier: "Ÿáÿ≤€åŸÜŸá Ÿæ€å⁄©:",
                payable: "ŸÇÿßÿ®ŸÑ Ÿæÿ±ÿØÿßÿÆÿ™:", note: "ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™ ÿ≥ŸÅÿßÿ±ÿ¥ (ÿßÿÆÿ™€åÿßÿ±€å)", tNum: "ÿ¥ŸÖÿßÿ±Ÿá ŸÖ€åÿ≤", phone: "ÿ¥ŸÖÿßÿ±Ÿá ÿ™ŸÖÿßÿ≥", addr: "ÿ¢ÿØÿ±ÿ≥ ÿØŸÇ€åŸÇ ÿ®ÿ±ÿß€å ÿßÿ±ÿ≥ÿßŸÑ",
                viewBtn: "ŸÖÿ¥ÿßŸáÿØŸá ÿ≥ŸÅÿßÿ±ÿ¥ Ÿà ÿ™ÿß€å€åÿØ", payBtn: "ÿ™ÿß€å€åÿØ ŸÜŸáÿß€å€å Ÿà Ÿæÿ±ÿØÿßÿÆÿ™", submitBtn: "ÿ™ÿß€å€åÿØ Ÿà ÿ´ÿ®ÿ™ ŸÜŸáÿß€å€å", unit: "ÿ™ŸàŸÖÿßŸÜ", empty: "ÿ≥ÿ®ÿØ ÿÆÿßŸÑ€å ÿßÿ≥ÿ™",
                confirm: "ŸÖÿ®ŸÑÿ∫: {amount} ÿ™ŸàŸÖÿßŸÜ\nŸæÿ≥ ÿßÿ≤ Ÿæÿ±ÿØÿßÿÆÿ™ ÿßÿ≥⁄©ÿ±€åŸÜ‚Äåÿ¥ÿßÿ™ ÿ®⁄Ø€åÿ±€åÿØ.\nÿ¢ŸÖÿßÿØŸá‚Äåÿß€åÿØÿü",
                expireTitle: "Ÿæÿß€åÿßŸÜ ÿßÿ¥ÿ™ÿ±ÿß⁄© ‚ö†Ô∏è", expireMsg1: "ÿßÿ¥ÿ™ÿ±ÿß⁄© ÿ™ŸÖÿßŸÖ ÿ¥ÿØŸá ÿßÿ≥ÿ™.", expireMsg2: "ÿ™ŸÖÿßÿ≥ ÿ®ÿß Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å.", dev: "ŸÖÿ¨ÿ±€å ÿ∑ÿ±ÿ≠: ⁄Øÿ±ŸàŸá ŸÜÿ±ŸÖ‚ÄåÿßŸÅÿ≤ÿßÿ±€å ŸÖŸéÿ¨ÿØ"
            },
            en: {
                open: "‚úÖ Open", closed: "‚õî Closed", loading: "Loading Menu...", all: "All", add: "Add", out: "Out of Stock",
                review: "üìã Review Order", table: "üçΩÔ∏è Table", delivery: "üõµ Delivery", total: "Items Total:", courier: "Courier Fee:",
                payable: "Total Payable:", note: "Order notes (optional)", tNum: "Table Number", phone: "Phone Number", addr: "Full Address",
                viewBtn: "View Order & Confirm", payBtn: "Confirm & Pay", submitBtn: "Confirm & Submit", unit: "Toman", empty: "Empty Cart",
                confirm: "Total: {amount} Toman\nPlease take a screenshot of receipt.\nProceed?",
                expireTitle: "Expired ‚ö†Ô∏è", expireMsg1: "Subscription ended.", expireMsg2: "Contact Support.", dev: "Developer: Majd Software Group"
            },
            ar: {
                open: "‚úÖ ŸÖŸÅÿ™Ÿàÿ≠", closed: "‚õî ŸÖÿ∫ŸÑŸÇ", loading: "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...", all: "ÿßŸÑŸÉŸÑ", add: "ÿ•ÿ∂ÿßŸÅÿ©", out: "ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±",
                review: "üìã ŸÖÿ±ÿßÿ¨ÿπÿ© ÿßŸÑÿ∑ŸÑÿ®", table: "üçΩÔ∏è ÿµÿßŸÑÿ©", delivery: "üõµ ÿ™ŸàÿµŸäŸÑ", total: "ÿßŸÑŸÖÿ¨ŸÖŸàÿπ:", courier: "ÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ:",
                payable: "ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä:", note: "ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)", tNum: "ÿ±ŸÇŸÖ ÿßŸÑÿ∑ÿßŸàŸÑÿ©", phone: "ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ", addr: "ÿßŸÑÿπŸÜŸàÿßŸÜ ÿ®ÿßŸÑÿ™ŸÅÿµŸäŸÑ",
                viewBtn: "ÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿ® ŸàÿßŸÑÿ™ÿ£ŸÉŸäÿØ", payBtn: "ÿ™ÿ£ŸÉŸäÿØ ŸàÿØŸÅÿπ", submitBtn: "ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ®", unit: "ÿ™ŸàŸÖÿßŸÜ", empty: "ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ©",
                confirm: "ÿßŸÑŸÖÿ®ŸÑÿ∫: {amount} ÿ™ŸàŸÖÿßŸÜ\nŸäÿ±ÿ¨Ÿâ ÿ™ÿµŸàŸäÿ± ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿ®ÿπÿØ ÿßŸÑÿØŸÅÿπ.\nŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ≥ÿ™ÿπÿØÿü",
                expireTitle: "ÿßŸÜÿ™ŸáŸâ ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉ ‚ö†Ô∏è", expireMsg1: "ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©.", expireMsg2: "ÿßÿ™ÿµŸÑ ÿ®ÿßŸÑÿØÿπŸÖ.", dev: "ÿßŸÑŸÖÿ∑Ÿàÿ±: ŸÖÿ¨ŸÖŸàÿπÿ© ŸÖÿ¨ÿØ ŸÑŸÑÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™"
            }
        };

        let currentLang = 'fa';
        let products = []; let cart = {}; let config = { name: "ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá", deliveryPrice: 0, phone: "", isOpen: true, paymentLink: "" };
        let orderType = 'table';
        const sheetId = new URLSearchParams(window.location.search).get('id') || "1XoE-tWd9sor7HgqQe67z3JQCZyvt6G-IcSz9u1miRiw";

        function changeLang(lang) {
            currentLang = lang;
            const t = translations[lang];
            document.getElementById('mainHtml').dir = (lang === 'en') ? 'ltr' : 'rtl';
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.id === 'btn-'+lang));

            document.getElementById('loadingText').innerText = t.loading;
            document.getElementById('reviewTitle').innerText = t.review;
            document.getElementById('btn-table').innerText = t.table;
            document.getElementById('btn-delivery').innerText = t.delivery;
            document.getElementById('txtItemsTotal').innerText = t.total;
            document.getElementById('txtDelPrice').innerText = t.courier;
            document.getElementById('txtFinal').innerText = t.payable;
            document.getElementById('userNote').placeholder = t.note;
            document.getElementById('tableNum').placeholder = t.tNum;
            document.getElementById('userPhone').placeholder = t.phone;
            document.getElementById('address').placeholder = t.addr;
            document.getElementById('devTitle').innerText = t.dev;
            document.getElementById('lockTitle').innerText = t.expireTitle;
            document.getElementById('lockMsg1').innerText = t.expireMsg1;
            document.getElementById('lockMsg2').innerText = t.expireMsg2;

            updateShopStatusDisplay();
            if (products.length > 0) render('all');
            calcTotal();
        }

        async function startApp() {
            try {
                const menuResp = await fetch(`https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=Menu&_t=${Date.now()}`);
                const settingsResp = await fetch(`https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=Settings&_t=${Date.now()}`);
                if(!menuResp.ok || !settingsResp.ok) throw new Error();
                
                parseSettings(await settingsResp.text());
                parseMenu(await menuResp.text());
                changeLang('fa');
            } catch (e) { document.getElementById('list').innerHTML = "<p style='text-align:center; color:red; margin-top:50px;'>Error: Check Internet or Sheet ID</p>"; }
        }

        function parseSettings(csv) {
            const rows = csvToArr(csv); let map = {};
            rows.forEach(r => { if(r.length >= 2) map[r[0].replace(/"/g,'').trim()] = r[1].replace(/"/g,'').trim(); });
            if(map['ShopName']) { config.name = map['ShopName']; document.getElementById('shopName').innerText = config.name; }
            if(map['HeaderImage']) document.documentElement.style.setProperty('--header-img', `url('${map['HeaderImage']}')`);
            if(map['BgImage']) document.documentElement.style.setProperty('--bg-img', `url('${map['BgImage']}')`);
            config.phone = map['Phone'] || "";
            config.deliveryPrice = parseInt(map['DeliveryPrice']) || 0;
            config.paymentLink = map['PaymentLink'] || "https://idpay.ir";
            config.isOpen = !(map['IsOpen'] && map['IsOpen'].toUpperCase() === 'FALSE');
            if (map['ExpireDate']) checkSubscription(map['ExpireDate']);
        }

        function updateShopStatusDisplay() {
            const s = document.getElementById('shopStatus'); const t = translations[currentLang];
            s.innerText = config.isOpen ? t.open : t.closed;
            s.className = "status-badge " + (config.isOpen ? "open" : "closed");
        }

        function checkSubscription(dateStr) {
            try {
                const diff = Math.ceil((new Date(dateStr) - new Date()) / (86400000)); 
                if (diff <= 0) { document.getElementById('lockScreen').style.display = 'flex'; document.body.style.overflow = 'hidden'; }
                else { const b = document.getElementById('subBadge'); b.innerHTML = `üìÖ ${diff} Days`; b.style.display = 'block'; }
            } catch (e) {}
        }

        function parseMenu(csv) {
            const rows = csvToArr(csv); products = [];
            for(let i=1; i<rows.length; i++) { 
                const r = rows[i]; if(r.length < 3) continue;
                products.push({ id: i, c: r[0].replace(/"/g, '').trim(), t: r[1].replace(/"/g, '').trim(), p: parseInt(r[2].replace(/,/g, '').trim()) || 0, i: r[3] ? r[3].replace(/"/g, '').trim() : '', active: !(r[4] && r[4].toUpperCase().includes('FALSE')) });
            }
        }

        function csvToArr(str) {
            const rows = []; let currentRow = []; let currentVal = ''; let insideQuote = false;
            for(let char of str) {
                if(char === '"') insideQuote = !insideQuote;
                else if(char === ',' && !insideQuote) { currentRow.push(currentVal); currentVal = ''; }
                else if(char === '\n' && !insideQuote) { currentRow.push(currentVal); rows.push(currentRow); currentRow = []; currentVal = ''; }
                else currentVal += char;
            }
            if(currentVal || currentRow.length) { currentRow.push(currentVal); rows.push(currentRow); }
            return rows;
        }

        function render(cat) {
            const list = document.getElementById('list'); const t = translations[currentLang];
            const catSet = new Set(products.map(p => p.c));
            let catHtml = `<div class="cat-btn ${cat==='all'?'active':''}" onclick="render('all')">${t.all}</div>`;
            catSet.forEach(c => { catHtml += `<div class="cat-btn ${cat===c?'active':''}" onclick="render('${c}')">${c}</div>`; });
            document.getElementById('cats').innerHTML = catHtml;
            list.innerHTML = '';
            const items = cat === 'all' ? products : products.filter(x => x.c === cat);
            items.forEach(x => {
                const count = cart[x.id] || 0;
                let btn = !x.active ? `<span style="color:#e74c3c;">${t.out}</span>` : (count === 0 ? `<div class="add-btn" onclick="upd(${x.id}, 1)">${t.add}</div>` : `<div class="qty-box show"><div class="q-btn" onclick="upd(${x.id}, 1)">+</div><div class="q-num">${count}</div><div class="q-btn" onclick="upd(${x.id}, -1)">-</div></div>`);
                list.innerHTML += `<div class="item ${!x.active ? 'inactive' : ''}"><img src="${x.i}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1170/1170576.png'"><div class="info"><h3>${x.t}</h3><div style="display:flex; justify-content:space-between; margin-top:5px; align-items:center;"><span class="price">${x.p.toLocaleString()}</span>${btn}</div></div></div>`;
            });
            calcTotal();
        }

        window.upd = (id, n) => { if(!config.isOpen) return; cart[id] = (cart[id] || 0) + n; if(cart[id]<=0) delete cart[id]; const act = document.querySelector('.cat-btn.active'); render(act && act.innerText !== translations[currentLang].all ? act.innerText : 'all'); };
        window.closeDetails = () => { document.getElementById('orderDetails').classList.remove('active'); calcTotal(); };

        function calcTotal() {
            let total = 0, count = 0, summaryHtml = ''; const t = translations[currentLang];
            for(let id in cart) { 
                const p = products.find(x=>x.id==id); 
                if(p) { total += p.p * cart[id]; count += cart[id]; summaryHtml += `<div class="summary-item"><span>${p.t}</span><div class="summary-controls"><div class="s-btn" onclick="upd(${id}, -1)">-</div><span>${cart[id]}</span><div class="s-btn" onclick="upd(${id}, 1)">+</div></div><span>${(p.p * cart[id]).toLocaleString()}</span></div>`; } 
            }
            let final = orderType === 'delivery' ? total + config.deliveryPrice : total;
            document.getElementById('summaryList').innerHTML = summaryHtml || `<p style="text-align:center;">${t.empty}</p>`;
            document.getElementById('itemsTotal').innerText = total.toLocaleString();
            document.getElementById('deliveryPriceDisplay').innerText = config.deliveryPrice.toLocaleString();
            document.getElementById('finalPayable').innerText = final.toLocaleString() + " " + t.unit;
            const bar = document.getElementById('cartBar'); const details = document.getElementById('orderDetails');
            if(count>0) { bar.style.display='flex'; if(!details.classList.contains('active')) document.getElementById('actionBtn').innerText = t.viewBtn; } 
            else { bar.style.display='none'; details.classList.remove('active'); }
        }

        window.setOrderType = (type) => {
            orderType = type; const t = translations[currentLang];
            document.querySelectorAll('.type-btn').forEach(b => b.classList.toggle('selected', b.id === 'btn-'+type));
            document.getElementById('form-table').classList.toggle('hidden', type !== 'table');
            document.getElementById('form-delivery').classList.toggle('hidden', type !== 'delivery');
            document.getElementById('deliveryRow').style.display = type === 'delivery' ? 'flex' : 'none';
            calcTotal();
            if(document.getElementById('orderDetails').classList.contains('active')) document.getElementById('actionBtn').innerText = type === 'delivery' ? t.payBtn : t.submitBtn;
        };

        window.processOrder = () => {
            const t = translations[currentLang]; if(!config.isOpen) return;
            const det = document.getElementById('orderDetails');
            if (!det.classList.contains('active')) { det.classList.add('active'); setOrderType(orderType); return; }
            let desc = ""; for(let id in cart) { const p = products.find(x=>x.id==id); if(p) desc += `${p.t}(${cart[id]}) - `; }
            if(orderType === 'table') {
                const tNum = document.getElementById('tableNum').value; if(!tNum) return alert(t.tNum + '?');
                window.open(`https://wa.me/${config.phone}?text=${encodeURIComponent(`Order\nTable: ${tNum}\n${desc}`)}`);
            } else {
                const ph = document.getElementById('userPhone').value; const ad = document.getElementById('address').value;
                if(!ph || !ad) return alert(t.phone + " & " + t.addr + " ?");
                let total = 0; for(let id in cart) { const p = products.find(x=>x.id==id); if(p) total += p.p * cart[id]; }
                if(confirm(t.confirm.replace('{amount}', (total + config.deliveryPrice).toLocaleString()))) {
                    let payUrl = config.paymentLink; if(payUrl.includes('idpay.ir')) payUrl += `${payUrl.includes('?') ? '&' : '?'}amount=${total + config.deliveryPrice}0`; window.location.href = payUrl;
                }
            }
        };

        startApp();
    </script>
</body>
</html>
